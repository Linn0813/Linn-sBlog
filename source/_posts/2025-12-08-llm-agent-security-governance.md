---
title: ğŸ›¡ï¸ 9/15ï½œAgent å®‰å…¨æ²»ç†ï¼šæƒé™ã€æ—¥å¿—ä¸å¯è§‚æµ‹æ€§
date: 2025-12-08 18:00:00
series: LLM/Agentç³»åˆ—æ•™ç¨‹
categories:
  - æŠ€æœ¯å­¦ä¹ ä¸è¡Œä¸šè¶‹åŠ¿
  - AIä¸ç ”ç©¶
tags:
  - LLM
  - Agent
  - å®‰å…¨æ²»ç†
  - æƒé™ç®¡ç†
  - æ—¥å¿—å®¡è®¡
  - å¯è§‚æµ‹æ€§
keywords: LLM, Agent, å®‰å…¨æ²»ç†, æƒé™ç®¡ç†, æ—¥å¿—å®¡è®¡, å¯è§‚æµ‹æ€§, POLP, æ²™ç®±æœºåˆ¶, Human-in-the-Loop, Promptæ³¨å…¥
description: 'æ·±å…¥è§£æ Agent å®‰å…¨æ²»ç†ï¼šä»æƒé™æ¨¡å‹è®¾è®¡ã€æ—¥å¿—å®¡è®¡åˆ°å¯è§‚æµ‹æ€§ç­–ç•¥ï¼Œæ„å»ºç”Ÿäº§ç¯å¢ƒä¸­å¯é çš„å®‰å…¨å±éšœï¼Œç¡®ä¿ Agent å®‰å…¨å¯æ§è¿è¡Œ'
top_img: /img/llm-agent-security-governance.png
cover: /img/llm-agent-security-governance.png
comments: true
toc: true
toc_number: true
toc_style_simple: false
copyright: true
copyright_author: yuxiaoling
copyright_info: ç‰ˆæƒæ‰€æœ‰ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚
mathjax: false
katex: false
aplayer: false
highlight_shrink: false
aside: true
noticeOutdate: false
---

> **è¿™æ˜¯ã€ŠLLM/Agent æ ¸å¿ƒçŸ¥è¯†ä½“ç³»ã€‹ç³»åˆ—ç¬¬ 9 ç¯‡**

> ä¸Šä¸€ç¯‡æˆ‘ä»¬æ·±å…¥è§£æäº† Agent çš„å·¥å…·ç³»ç»Ÿï¼ŒæŒæ¡äº† Function Calling æœºåˆ¶ä¸å·¥å…·æ ‡å‡†åŒ–è®¾è®¡ã€‚

> æœ¬ç¯‡ï¼Œæˆ‘ä»¬å°†èšç„¦ Agent çš„å®‰å…¨æ²»ç†ï¼Œç¡®ä¿æƒé™ã€æ—¥å¿—å’Œå¯è§‚æµ‹æ€§æœºåˆ¶å®Œå¤‡ï¼Œä¸ºç”Ÿäº§ç¯å¢ƒä¸­çš„ Agent æ„å»ºå¯é å±éšœã€‚

---

## ğŸš€ å¯¼è¨€ â€” ä»å®éªŒå®¤åˆ°ç”Ÿäº§ç¯å¢ƒçš„æŒ‘æˆ˜

Agent çš„æœ€å¤§ä»·å€¼åœ¨äº**è‡ªä¸»æ€§**ï¼ŒåŒæ—¶ä¹Ÿå¸¦æ¥äº†æ½œåœ¨é£é™©ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒAgent å¯èƒ½å‡ºç°ï¼š

1. **æ— é™å¾ªç¯**ï¼šé€»è¾‘é”™è¯¯æˆ–ç¯å¢ƒåé¦ˆå¼‚å¸¸å¯¼è‡´å¾ªç¯ä¸æ­¢ï¼Œæµªè´¹èµ„æºã€‚

2. **å·¥å…·æ»¥ç”¨**ï¼šé”™è¯¯è°ƒç”¨é«˜é£é™©å·¥å…·ï¼ˆå¦‚åˆ é™¤æ•°æ®ã€å‘é€åƒåœ¾é‚®ä»¶ï¼‰ã€‚

3. **Prompt æ³¨å…¥æ”»å‡»**ï¼šæ¶æ„ç”¨æˆ·é€šè¿‡ Prompt ç»•è¿‡ System Prompt æˆ–å®‰å…¨é™åˆ¶ã€‚

æœ¬ç¯‡å°†å…¨é¢è§£æ Agent çš„ **å®‰å…¨æ²»ç†ï¼ˆGovernanceï¼‰ä½“ç³»**ï¼Œè¦†ç›–æƒé™æ¨¡å‹è®¾è®¡ã€æ—¥å¿—å®¡è®¡åŠå¯è§‚æµ‹æ€§ï¼ˆObservabilityï¼‰ç­–ç•¥ï¼Œä¸ºç”Ÿäº§ç¯å¢ƒä¸­çš„ Agent æ„å»ºå¯é å±éšœã€‚

---

## ä¸€ã€æƒé™ä¸æ²™ç®±ï¼šAgent çš„å®‰å…¨è¾¹ç•Œ

Agent çš„æ¯ä¸€æ¬¡ Action éƒ½å¯èƒ½å¯¹å¤–éƒ¨ç¯å¢ƒäº§ç”Ÿå®é™…å½±å“ï¼Œå› æ­¤å¿…é¡»å¯¹å…¶è¡Œä¸ºè¿›è¡Œä¸¥æ ¼é™åˆ¶å’Œéš”ç¦»ã€‚

### 1.1 æœ€å°æƒé™åŸåˆ™ï¼ˆPrinciple of Least Privilege, POLPï¼‰

* **æ ¸å¿ƒç†å¿µï¼š** Agent ä»…æ‹¥æœ‰å®Œæˆç‰¹å®šä»»åŠ¡æ‰€éœ€çš„æœ€å°æƒé™ã€‚

* **å®è·µæ–¹æ³•ï¼š**

  * **è§’è‰²åˆ†çº§**ï¼šæŒ‰åŠŸèƒ½åˆ’åˆ† Agentï¼Œä¾‹å¦‚ `ReadOnlyAgent`ã€`DataEntryAgent`ã€`AdminAgent`ã€‚

  * **å·¥å…·éš”ç¦»**ï¼šä¸åŒè§’è‰²åªèƒ½è®¿é—®ç™½åå•å·¥å…·ï¼Œä¾‹å¦‚å®¢æœ Agent æ— æƒè°ƒç”¨ `DeleteDatabaseRecord()`ã€‚

  * **æ•°æ®è„±æ•**ï¼šæ•æ„Ÿæ•°æ®åœ¨ä¼ é€’ç»™ Agent å‰è¿›è¡Œè„±æ•æˆ–åŒ¿ååŒ–å¤„ç†ï¼Œé™ä½æ³„éœ²é£é™©ã€‚

### 1.2 æ²™ç®±æœºåˆ¶ä¸ä»£ç æ‰§è¡Œå®‰å…¨

æ‰§è¡Œä»£ç çš„å·¥å…·å¿…é¡»åœ¨æ²™ç®±å†…è¿è¡Œï¼Œä»¥é˜²æ­¢å¯¹å®¿ä¸»ç¯å¢ƒçš„ç ´åã€‚

* **æ²™ç®±ï¼ˆSandboxï¼‰**ï¼šéš”ç¦»ç¯å¢ƒï¼Œå¦‚ **Docker å®¹å™¨**æˆ– **WebAssembly**ï¼Œé™åˆ¶ä»£ç è®¿é—®ç³»ç»Ÿèµ„æºã€‚

* **é£é™©éš”ç¦»**ï¼šæ²™ç®±é˜»æ­¢æ¶æ„æˆ–ç¼ºé™·ä»£ç é€ƒé€¸ï¼Œä¿æŠ¤ä¸»æœºæ–‡ä»¶ç³»ç»Ÿå’Œå…³é”®æœåŠ¡ã€‚

* **èµ„æºé™åˆ¶**ï¼šæ§åˆ¶ CPUã€å†…å­˜ã€ç½‘ç»œå¸¦å®½ï¼Œé˜²æ­¢å•ä¸ª Agent å ç”¨è¿‡å¤šèµ„æºã€‚

> **ç¤ºä¾‹ï¼šPython Executor æ²™ç®±æ‰§è¡Œ**

```python

def safe_execute(agent_id, tool_name, args):

    if not agent_has_permission(agent_id, tool_name):

        raise PermissionError(f"{agent_id} lacks permission for {tool_name}")

    args = sanitize_input(args)  # é˜²æ³¨å…¥

    with SandboxContainer() as sandbox:

        result = sandbox.run_tool(tool_name, args)

    return Observation(result)

```

---

## äºŒã€æ—¥å¿—ä¸å®¡è®¡ï¼šè¿½è¸ª Agent çš„"æ€ç»´"

è‡ªä¸» Agent çš„å†³ç­–è¿‡ç¨‹ï¼ˆThought â†’ Action â†’ Observationï¼‰å¿…é¡»å®Œæ•´è®°å½•ï¼Œä¾¿äºè°ƒè¯•ã€å®¡è®¡å’Œä¼˜åŒ–ã€‚

### 2.1 ç»“æ„åŒ–æ—¥å¿—ï¼ˆStructured Loggingï¼‰

æ—¥å¿—åº”ä¸º **ç»“æ„åŒ– JSON** æ ¼å¼ï¼Œè€Œéæ™®é€šæ–‡æœ¬ï¼Œæ–¹ä¾¿æœºå™¨å¤„ç†å’Œåˆ†æã€‚

| å­—æ®µ            | å†…å®¹                                            | ä½œç”¨            |
| :------------ | :-------------------------------------------- | :------------ |
| `timestamp`   | æ¯«ç§’çº§æ—¶é—´æˆ³                                        | äº‹ä»¶é¡ºåºè¿½è¸ª        |
| `agent_id`    | Agent å®ä¾‹å”¯ä¸€ ID                                 | åŒºåˆ†ä¸åŒ Agent è¡Œä¸º |
| `step_number` | Agentic Loop è¿­ä»£æ¬¡æ•°                             | æ£€æµ‹æ— é™å¾ªç¯        |
| `log_level`   | DEBUG / INFO / ERROR                          | å¿«é€Ÿç­›æŸ¥é—®é¢˜        |
| `event_type`  | PLANNING / ACTION / OBSERVATION / TERMINATION | è¡Œä¸ºé˜¶æ®µæ ‡è¯†        |
| `details`     | Thoughtã€Action å‚æ•°æˆ– Observation å†…å®¹             | å†³ç­–é€»è¾‘å®¡æŸ¥        |

### 2.2 å®¡è®¡è·Ÿè¸ªï¼ˆAudit Trailï¼‰

ä¸“æ³¨äº **é«˜é£é™©æ“ä½œ**ï¼Œç¡®ä¿è¡Œä¸ºå¯è¿½æº¯ã€‚

* **è®°å½•å†…å®¹**ï¼šæ¯ä¸€æ¬¡æ”¹å˜å¤–éƒ¨çŠ¶æ€çš„ Actionï¼Œä¾‹å¦‚æ•°æ®åº“å†™å…¥ã€API è°ƒç”¨ã€‚

* **ä¸å¯ç¯¡æ”¹**ï¼šå­˜å‚¨äºå®‰å…¨ã€åªè¯»æˆ–åŠ å¯†çš„ç³»ç»Ÿï¼Œå¦‚ ELK Stack æˆ–æ•°æ®æ¹–ã€‚

* **ç”¨é€”**ï¼šå‘ç”Ÿå®‰å…¨äº‹ä»¶æˆ–æ•°æ®é”™è¯¯æ—¶ï¼Œå¯ç²¾ç¡®è¿½è´£ã€‚

---

## ä¸‰ã€å¯è§‚æµ‹æ€§ï¼šå®æ—¶ç†è§£ç³»ç»ŸçŠ¶æ€

å¯è§‚æµ‹æ€§ä¸ä»…è®°å½•æ—¥å¿—ï¼Œæ›´èƒ½ **å®æ—¶ç›‘æ§ Agent å†…éƒ¨çŠ¶æ€**ï¼Œåœ¨å¼‚å¸¸å‘ç”Ÿæ—¶è¿…é€Ÿå¹²é¢„ã€‚

### 3.1 Metricsï¼ˆå…³é”®æŒ‡æ ‡ï¼‰ç›‘æ§

å¯ç›‘æ§æŒ‡æ ‡ç¤ºä¾‹ï¼š

* **æˆåŠŸç‡/å¤±è´¥ç‡**ï¼šä»»åŠ¡å®Œæˆç‡ã€å·¥å…·è°ƒç”¨æˆåŠŸç‡

* **å»¶è¿Ÿ/é€Ÿåº¦**ï¼šLLM æ¨ç†è€—æ—¶ã€æ¯æ­¥å¹³å‡æ—¶é—´

* **æˆæœ¬æŒ‡æ ‡**ï¼šToken æ¶ˆè€—é‡ã€API è°ƒç”¨æˆæœ¬

* **å¼‚å¸¸æŒ‡æ ‡**ï¼šè¿ç»­é‡å¤ Action æ•°é‡ã€é”™è¯¯ç é¢‘ç‡ï¼ˆç”¨äºæ£€æµ‹æ— é™å¾ªç¯ï¼‰

### 3.2 Human-in-the-Loopï¼ˆäººå·¥ä»‹å…¥ï¼‰

åœ¨é£é™©é«˜æˆ–æ— æ³•è‡ªåŠ¨å¤„ç†æ—¶ï¼Œå¼•å…¥äººå·¥å®¡æ‰¹ï¼š

* **å®¡æ‰¹æµç¨‹**ï¼šæ•æ„Ÿæ“ä½œï¼ˆå¦‚è´¢åŠ¡è½¬è´¦ã€æ ¸å¿ƒé…ç½®ä¿®æ”¹ï¼‰å‰æš‚åœï¼Œå‘é€ Thought ä¸ Action ç»†èŠ‚ç»™æ“ä½œå‘˜å®¡æ‰¹ã€‚

* **å¼‚å¸¸æ¥ç®¡**ï¼šè¿ç»­å¤±è´¥æˆ–è§¦å‘å®‰å…¨å‘Šè­¦æ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨ç»ˆæ­¢ Agent å¾ªç¯ï¼Œå°†ä¸Šä¸‹æ–‡å’Œæ—¥å¿—æ‰“åŒ…å‘é€ç»™äººç±»å¤„ç†ã€‚

> **ğŸ’¡ åè¯å¡ç‰‡**

>

> * **Observabilityï¼ˆå¯è§‚æµ‹æ€§ï¼‰**ï¼šç³»ç»Ÿå†…éƒ¨çŠ¶æ€èƒ½å¦é€šè¿‡æ—¥å¿—ã€æŒ‡æ ‡ã€è¿½è¸ªè¢«ç†è§£çš„ç¨‹åº¦ã€‚

> * **Prompt æ³¨å…¥æ”»å‡»ï¼ˆPrompt Injectionï¼‰**ï¼šæ¶æ„ç”¨æˆ·é€šè¿‡ Prompt ç»•è¿‡ç³»ç»Ÿé™åˆ¶ã€‚

> * **Human-in-the-Loop**ï¼šåœ¨ Agent å†³ç­–ä¸­å¼•å…¥äººå·¥å®¡æ‰¹æˆ–æ¥ç®¡ã€‚

---

## ğŸ” æ€»ç»“ â€” å®‰å…¨æ²»ç†èµ‹èƒ½å¯é  Agent

Agent æ²»ç†ä½“ç³»æ˜¯è®©å¼ºå¤§å·¥å…·å˜ä¸º **å¯é ç³»ç»Ÿ** çš„æ ¸å¿ƒä¿éšœã€‚

é€šè¿‡ï¼š

1. **æƒé™æ§åˆ¶**ï¼ˆPOLP + è§’è‰²åˆ†çº§ + å·¥å…·éš”ç¦»ï¼‰

2. **å®Œå¤‡æ—¥å¿—ä¸å®¡è®¡**ï¼ˆç»“æ„åŒ–æ—¥å¿— + å®¡è®¡è·Ÿè¸ªï¼‰

3. **å®æ—¶å¯è§‚æµ‹æ€§**ï¼ˆMetrics + Human-in-the-Loopï¼‰

æˆ‘ä»¬èƒ½ä¿¡ä»» Agent åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è‡ªä¸»è¿è¡Œã€‚

> å®‰å…¨æ²»ç†ä¸æ˜¯é™åˆ¶èƒ½åŠ›ï¼Œè€Œæ˜¯ä¸º Agent åˆ’å®š**å¯é å·¥ä½œè¾¹ç•Œ**ï¼Œé¿å…é£é™©å¤–æº¢ã€‚

---

## ğŸ“š çŸ¥è¯†æ¥æºä¸è¿›é˜¶é˜…è¯»

| ä¸»é¢˜           | é“¾æ¥                                                                                                       |
| ------------ | -------------------------------------------------------------------------------------------------------- |
| **Agent å®‰å…¨** | [OWASP Top 10 for LLMs](https://owasp.org/)                                                              |
| **å¯è§‚æµ‹æ€§å·¥å…·**   | [Langfuse: LLM Observability](https://www.langfuse.com/)                                                 |
| **ç»“æ„åŒ–æ—¥å¿—**    | [Structured Logging Best Practices](https://www.loggly.com/ultimate-guide/json-logging/)                 |
| **æƒé™æ¨¡å‹**     | [RBAC in Distributed Systems](https://docs.microsoft.com/en-us/azure/role-based-access-control/overview) |

---

## ğŸ”” ä¸‹ä¸€ç¯‡é¢„å‘Š

æˆ‘ä»¬å·²æ²»ç†å•ä½“ Agentï¼Œç°åœ¨æ¢ç´¢æ›´é«˜å¤æ‚åº¦ï¼š**å¤š Agent åä½œ**ï¼Œè®© Agent åƒå›¢é˜Ÿä¸€æ ·é«˜æ•ˆå·¥ä½œã€‚

**ç¬¬ 10 ç¯‡æ ‡é¢˜ï¼ˆæš‚å®šï¼‰ï¼š**

### ã€Šå¤š Agent åä½œï¼šè®© Agent åƒå›¢é˜Ÿä¸€æ ·é«˜æ•ˆå·¥ä½œã€‹

