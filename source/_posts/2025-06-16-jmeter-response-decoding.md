---
title: å‹æµ‹è¸©å‘å®å½• | è§£ç æ¥å£å“åº”å­—æ®µæ–¹ä¾¿æŸ¥çœ‹ï¼Œæ–­è¨€å¤±æ•ˆé—®é¢˜åŠè§£å†³æ–¹æ¡ˆåˆ†äº« ğŸš§
date: 2025-06-16 10:29:30
tags:
  - JMeter
  - æ¥å£å‹æµ‹
  - å“åº”è§£ç 
  - æ–­è¨€å¤±æ•ˆ
  - é—®é¢˜è§£å†³
updated: {{current_date_time}} 
categories:
  - æ€§èƒ½ã€å®‰å…¨ & ç‰¹æ®Šæµ‹è¯•ï¼ˆPerformance, Security & Special Testingï¼‰
  - æ€§èƒ½æµ‹è¯•
  - é—®é¢˜æ’æŸ¥
keywords: JMeter, æ¥å£å‹æµ‹, å“åº”è§£ç , Base64ç¼–ç , gzipå‹ç¼©, æ–­è¨€å¤±æ•ˆ, é—®é¢˜è§£å†³
description: åˆ†äº«åœ¨æ¥å£å‹æµ‹ä¸­ä½¿ç”¨JMeterå¯¹Base64ç¼–ç +gzipå‹ç¼©çš„æ¥å£å“åº”å­—æ®µè¿›è¡Œè§£ç æ—¶ï¼Œé‡åˆ°æ–­è¨€å¤±æ•ˆé—®é¢˜çš„æ’æŸ¥è¿‡ç¨‹åŠè§£å†³æ–¹æ¡ˆï¼Œå¸®åŠ©æé«˜æ¥å£å‹æµ‹æ•ˆç‡ã€‚
top_img: /img/jmeter-response-decoding.png
cover: /img/jmeter-response-decoding.png
comments: true
toc: true
toc_number: true
toc_style_simple: false
copyright: true
copyright_author: yuxiaoling
copyright_info: ç‰ˆæƒæ‰€æœ‰ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚
mathjax: false
katex: false
aplayer: false
highlight_shrink: false
aside: true
abcjs: false
noticeOutdate: false
---

åœ¨æ¥å£å‹æµ‹ä¸­ï¼Œé‡åˆ°æ¥å£å“åº”ä¸­éƒ¨åˆ†å­—æ®µè¢« **Base64ç¼–ç +gzipå‹ç¼©**ï¼Œä¸ºäº†æ–¹ä¾¿äººå·¥æŸ¥çœ‹æ¥å£å“åº”å†…å®¹ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šåœ¨ JMeter çš„**åç½®å¤„ç†å™¨**ä¸­å¯¹å­—æ®µè¿›è¡Œè§£ç å¤„ç†ã€‚

ä½†åœ¨å®æ“è¿‡ç¨‹ä¸­ï¼Œæˆ‘é‡åˆ°äº†ä¸€ä¸ªæ£˜æ‰‹çš„é—®é¢˜ï¼š  
> åŠ å…¥äº†è§£ç åç½®å¤„ç†å™¨åï¼Œä¹‹å‰èƒ½é€šè¿‡çš„å“åº”æ–­è¨€çªç„¶å…¨éƒ¨å¤±è´¥ï¼Œæ–­è¨€æ¡ä»¶ä¸åŒ¹é…ã€‚  

ç»è¿‡æ’æŸ¥å’Œæ”¹è¿›ï¼Œæœ€ç»ˆæ‰¾åˆ°åŸå› å’Œè§£å†³æ–¹æ¡ˆã€‚æœ¬æ–‡å°†å…¨è¿‡ç¨‹åˆ†äº«ï¼Œå¸®ä½ é¿å…ç±»ä¼¼å‘ï¼Œæé«˜æ¥å£å‹æµ‹æ•ˆç‡ã€‚ğŸ’¡

---

## 1. ä¸ºä»€ä¹ˆè¦åšå“åº”å­—æ®µè§£ç ï¼Ÿ

æ¥å£å“åº”ä¸­çš„éƒ¨åˆ†å­—æ®µï¼Œä¸ºäº†èŠ‚çœå¸¦å®½æˆ–æ•°æ®ä¿æŠ¤ï¼Œé‡‡ç”¨äº† Base64 ç¼–ç å’Œ gzip å‹ç¼©ï¼Œå¯¼è‡´å“åº”å†…å®¹æ˜¯ä¸€ä¸²éš¾ä»¥ç›´æ¥è¾¨è®¤çš„ç¼–ç å­—ç¬¦ä¸²ã€‚

**è§£ç å**ï¼Œå¯ä»¥è·å¾—æ¸…æ™°çš„æ˜æ–‡ JSONï¼Œæ–¹ä¾¿äººå·¥åœ¨ JMeter çš„â€œæŸ¥çœ‹ç»“æœæ ‘â€ä¸­å¿«é€Ÿç¡®è®¤æ¥å£è¿”å›æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚

> âš ï¸ **æ³¨æ„ï¼šæ­¤å¤„çš„è§£ç ç›®çš„æ˜¯æ–¹ä¾¿â€œäººå·¥æŸ¥çœ‹â€ï¼Œè€Œéç›´æ¥ç”¨äºæ–­è¨€ã€‚**

---

## 2. å‹æµ‹æµç¨‹å…¨æ™¯å›¾ ğŸ¬

è®©æˆ‘ä»¬å…ˆçœ‹ä¸‹ JMeter å‹æµ‹ä¸­å“åº”å­—æ®µè§£ç çš„å…¸å‹æµç¨‹ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‘é€HTTPè¯·æ±‚â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è·å–å“åº”æ•°æ®â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åç½®å¤„ç†å™¨  â”‚ â† è§£ç ï¼ˆBase64è§£ç  + gzipè§£å‹ï¼‰
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å­˜å‚¨æ˜æ–‡ç»“æœâ”‚ â† ä¼ ç»™æ–­è¨€ä½¿ç”¨çš„å˜é‡
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å“åº”æ–­è¨€    â”‚ â† æ–­è¨€æ˜æ–‡å­—æ®µ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. æ¥å£å“åº”ç¤ºä¾‹ä¸é¢„æœŸç»“æ„

### 3.1 åŸå§‹æ¥å£å“åº”ç¤ºä¾‹

```json
{
  "code": 0,
  "msg": "success",
  "payload": {
    "compEncodeFlag": 1,
    "data": "H4sIAAAAAAAAANWdS2/cRhKA/4vOhsB+kOz2LcfFLjaHePcSBIISTRwhiiTIUrLeYP/7cobd7FKVqop..."
  }
}
```

- `code`: çŠ¶æ€ç ï¼Œ0è¡¨ç¤ºæˆåŠŸ  
- `msg`: æç¤ºä¿¡æ¯  
- `payload`: ä¸šåŠ¡è´Ÿè½½  
- `compEncodeFlag=1`ï¼šè¡¨ç¤º `data` å­—æ®µç»è¿‡ Base64 ç¼–ç å’Œ gzip å‹ç¼©  
- `data`: ç¼–ç å‹ç¼©çš„ä¸šåŠ¡æ•°æ®

### 3.2 é¢„æœŸè§£ç åçš„æ˜æ–‡ JSON

è§£ç åï¼Œ`data` å­—æ®µåº”è¿˜åŸä¸ºæ˜æ–‡ JSONï¼Œç¤ºä¾‹ï¼š

```json
{
  "messages": [
    {"role": "user", "content": "Hello"}
  ],
  "status": "ok"
}
```

è¿™ä¾¿äºäººå·¥é˜…è¯»å’Œæ–­è¨€åˆ¤æ–­ã€‚

---

## 4. åç½®å¤„ç†å™¨è§£ç è„šæœ¬ç¤ºä¾‹ï¼ˆGroovyï¼‰

```groovy
import groovy.json.JsonSlurper
import groovy.json.JsonOutput
import java.util.zip.GZIPInputStream
import java.util.Base64

// 1. è·å– JMeter å˜é‡ prev ä¸­çš„åŸå§‹å“åº”å­—ç¬¦ä¸²
def response = prev.getResponseDataAsString()

// 2. åˆ›å»º JsonSlurper ç”¨äºè§£æ JSON
def jsonSlurper = new JsonSlurper()

// 3. å°†å“åº”å­—ç¬¦ä¸²è§£æä¸º JSON å¯¹è±¡
def parsed = jsonSlurper.parseText(response)

// 4. åˆ¤æ–­ payload ä¸­æ˜¯å¦å­˜åœ¨ compEncodeFlag ä¸”å€¼ä¸º1ï¼Œä¸” data å­—æ®µå­˜åœ¨ï¼Œè¡¨ç¤ºéœ€è¦è§£ç 
if (parsed?.payload?.compEncodeFlag == 1 && parsed?.payload?.data) {
    try {
        // 5. å¯¹ payload.data å…ˆè¿›è¡Œ Base64 è§£ç ï¼Œå¾—åˆ°å‹ç¼©åçš„äºŒè¿›åˆ¶æ•°æ®
        byte[] compressed = Base64.decoder.decode(parsed.payload.data)

        // 6. ä½¿ç”¨ ByteArrayInputStream åŒ…è£…è§£ç åçš„å­—èŠ‚æ•°ç»„
        ByteArrayInputStream bais = new ByteArrayInputStream(compressed)

        // 7. ä½¿ç”¨ GZIPInputStream å¯¹å­—èŠ‚æµè¿›è¡Œ gzip è§£å‹
        GZIPInputStream gis = new GZIPInputStream(bais)

        // 8. å°†è§£å‹æµè½¬æˆå­—ç¬¦æµï¼ŒæŒ‡å®š UTF-8 ç¼–ç 
        InputStreamReader reader = new InputStreamReader(gis, "UTF-8")

        // 9. ä½¿ç”¨ BufferedReader é€è¡Œè¯»å–è§£å‹åçš„å†…å®¹
        BufferedReader bufferedReader = new BufferedReader(reader)
        StringBuilder decompressed = new StringBuilder()
        String line

        // 10. é€è¡Œè¯»å–ï¼Œæ‹¼æ¥æˆå®Œæ•´å­—ç¬¦ä¸²
        while ((line = bufferedReader.readLine()) != null) {
            decompressed.append(line)
        }

        // 11. å°è¯•å°†è§£å‹åçš„å­—ç¬¦ä¸²è§£æä¸º JSON
        def dataDecoded
        try {
            dataDecoded = jsonSlurper.parseText(decompressed.toString())
        } catch (Exception e) {
            // å¦‚æœä¸æ˜¯æ ‡å‡† JSONï¼Œåˆ™ç›´æ¥ä¿ç•™å­—ç¬¦ä¸²å½¢å¼
            dataDecoded = decompressed.toString()
        }

        // 12. å°†åŸç»“æ„ä¸­çš„ payload.data å­—æ®µæ›¿æ¢æˆè§£ç åçš„æ˜æ–‡ JSON æˆ–å­—ç¬¦ä¸²
        parsed.payload.data = dataDecoded

        // 13. æŠŠæ•´ä¸ªç»“æ„é‡æ–°è½¬æ¢æˆ JSON å­—ç¬¦ä¸²
        def newResponse = JsonOutput.toJson(parsed)

        // 14. æ›´æ–° JMeter å˜é‡ prev ä¸­çš„å“åº”æ•°æ®ï¼Œç”¨è§£ç åçš„å†…å®¹æ›¿ä»£åŸå§‹å“åº”
        prev.setResponseData(newResponse, "UTF-8")

    } catch (Exception e) {
        // 15. æ•è·å¼‚å¸¸å¹¶å†™å…¥ JMeter æ—¥å¿—ï¼Œæ–¹ä¾¿æ’æŸ¥è§£ç å¤±è´¥åŸå› 
        log.error("è§£ç å¤±è´¥ï¼š" + e.message)
    }
}

```

---

## 5. è¸©å‘ç°åœºï¼šæ–­è¨€å¤±æ•ˆé—®é¢˜

åŠ å…¥è§£ç åç½®å¤„ç†å™¨åï¼Œä¹‹å‰èƒ½é€šè¿‡çš„å“åº”æ–­è¨€å…¨éƒ¨å¤±è´¥ã€‚

åŸå› ï¼š  
- **å“åº”æ–­è¨€é»˜è®¤åªå¯¹â€œåŸå§‹å“åº”ä½“â€ç”Ÿæ•ˆ**ï¼Œä¹Ÿå°±æ˜¯è¿˜æœªè§£ç çš„ç¼–ç å¯†æ–‡ï¼›  
- è§£ç åçš„æ˜æ–‡å­˜æ”¾åœ¨ `${decodedData}` å˜é‡ä¸­ï¼Œæ–­è¨€æœªå¯¹è¯¥å˜é‡è¿›è¡Œåˆ¤æ–­ï¼›  
- å¯¼è‡´æ–­è¨€æ¡ä»¶å’Œæ–­è¨€ç›®æ ‡ä¸åŒ¹é…ã€‚

---

## 6. è§£å†³æ–¹æ¡ˆ

- **è°ƒæ•´æ–­è¨€å¯¹è±¡**ï¼šæ”¹ä¸ºé’ˆå¯¹ `${decodedData}` å˜é‡æ–­è¨€ï¼Œè€Œéé»˜è®¤å“åº”ä½“ã€‚  
- **ç¡®è®¤æ–­è¨€æ‰§è¡Œé¡ºåº**ï¼šç¡®ä¿åç½®å¤„ç†å™¨å…ˆæ‰§è¡Œï¼Œæ–­è¨€åæ‰§è¡Œã€‚  
- **è°ƒè¯•è¾…åŠ©**ï¼šç”¨è°ƒè¯•é‡‡æ ·å™¨æ‰“å° `${decodedData}`ï¼ŒéªŒè¯è§£ç ç»“æœã€‚

---

## 7. æ–­è¨€ç¤ºä¾‹

### 7.1 å“åº”æ–­è¨€

é…ç½®å“åº”æ–­è¨€æ—¶ï¼š

- é€‰æ‹©â€œå“åº”æ–‡æœ¬â€å­—æ®µ  
- æ–­è¨€å†…å®¹å†™ `${decodedData}`  
- æ–­è¨€æ¡ä»¶ï¼ˆå¦‚åŒ…å«å­—ç¬¦ä¸²ï¼‰å†™æ˜é¢„æœŸå†…å®¹ï¼Œå¦‚ `success`

### 7.2 JSR223æ–­è¨€ç¤ºä¾‹

å¦‚æœæ–­è¨€æ›´å¤æ‚ï¼Œå¯ä»¥ç”¨ JSR223æ–­è¨€è„šæœ¬ï¼š

```groovy
def decoded = vars.get("decodedData")
assert decoded.contains("success") : "æ–­è¨€å¤±è´¥ï¼šæœªæ‰¾åˆ°successå…³é”®å­—"
```

---

## 8. æ€»ç»“ä¸å»ºè®® ğŸ¯

| äº‹é¡¹         | å»ºè®®                                                         |
|--------------|--------------------------------------------------------------|
| å“åº”å­—æ®µè§£ç  | ç”¨åç½®å¤„ç†å™¨å®Œæˆ Base64 + gzip è§£ç ï¼Œæ–¹ä¾¿äººå·¥æŸ¥çœ‹å“åº”å†…å®¹       |
| æ–­è¨€å†™æ³•     | æ–­è¨€è¦é’ˆå¯¹è§£ç åçš„å˜é‡ `${decodedData}`ï¼Œä¸æ˜¯é»˜è®¤å“åº”ä½“         |
| æ‰§è¡Œé¡ºåº     | ç¡®ä¿åç½®å¤„ç†å™¨å…ˆæ‰§è¡Œï¼Œæ–­è¨€åæ‰§è¡Œ                               |
| è°ƒè¯•æ–¹æ³•     | ç”¨è°ƒè¯•é‡‡æ ·å™¨æ‰“å°å˜é‡ï¼Œç¡®è®¤æ–­è¨€ä½¿ç”¨çš„æ•°æ®æ­£ç¡®                     |
| å¸¸è§å‘       | æ–­è¨€é»˜è®¤åªé’ˆå¯¹åŸå“åº”ä½“ï¼Œå¿½ç•¥åç½®å¤„ç†å™¨å˜é‡å¯¼è‡´æ–­è¨€å¤±è´¥           |

---

## 9. å°è´´å£« ğŸŒŸ

- å¤æ‚æ–­è¨€ä¼˜å…ˆä½¿ç”¨ JSR223æ–­è¨€ï¼Œè‡ªå®šä¹‰æ–­è¨€é€»è¾‘  
- æ—¥å¿—å†™è¶³ï¼Œæ–¹ä¾¿å¿«é€Ÿå®šä½é—®é¢˜  
- è°ƒè¯•é‡‡æ ·å™¨æ˜¯æ’æŸ¥é—®é¢˜åˆ©å™¨ï¼Œéšæ—¶æŸ¥çœ‹å˜é‡å®é™…å†…å®¹  

---

## 10. ç»“è¯­

å‹æµ‹æ—¶é‡åˆ°ç¼–ç å­—æ®µï¼Œè§£ç æ–¹ä¾¿æŸ¥çœ‹æ˜¯éå¸¸å¥½çš„å®è·µï¼Œä½†åˆ«å¿˜äº†æ–­è¨€ä¹Ÿè¦å¯¹åº”ä¿®æ”¹ï¼Œå¦åˆ™æ–­è¨€å¤±æ•ˆè®©ä½ ä¸€å¤´é›¾æ°´ã€‚  

å¸Œæœ›æœ¬æ–‡çš„å®æˆ˜åˆ†äº«èƒ½å¸®åŠ©ä½ å¿«é€Ÿè§£å†³ç±»ä¼¼é—®é¢˜ï¼Œæ¬¢è¿ç•™è¨€äº¤æµä½ é‡åˆ°çš„å‹æµ‹æŒ‘æˆ˜ï¼æˆ‘ä»¬ä¸€èµ·æˆé•¿ğŸ’ªã€‚

---

