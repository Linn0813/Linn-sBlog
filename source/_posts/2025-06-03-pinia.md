---
title: å‰ç«¯PiniaçŠ¶æ€ç®¡ç†å®è·µ
date: 2025-06-03 22:55:19
tags:
  - Pinia
  - Vue
  - å‰ç«¯çŠ¶æ€ç®¡ç†
  - Vue3
updated: {{current_date_time}} 
categories:
  - æŠ€æœ¯å­¦ä¹  & è¡Œä¸šè¶‹åŠ¿ï¼ˆLearning & Industry Trendsï¼‰
  - å‰ç«¯å¼€å‘
  - çŠ¶æ€ç®¡ç†
keywords: Pinia, Vue, å‰ç«¯çŠ¶æ€ç®¡ç†, Vue3, Vuex, çŠ¶æ€æŒä¹…åŒ–, è®¡ç®—å±æ€§
description: >-
  è¯¦ç»†ä»‹ç»å‰ç«¯ Pinia çŠ¶æ€ç®¡ç†åº“çš„å®è·µåº”ç”¨ï¼Œæ¶µç›– Pinia ç®€ä»‹ã€åœ¨ç®¡ç†å¹³å°é¡¹ç›®ä¸­çš„å¼•å…¥æ­¥éª¤ã€åˆ›å»ºå’Œä½¿ç”¨ Store çš„æ–¹æ³•ï¼Œä»¥åŠè®¡ç®—å±æ€§ã€æ’ä»¶ç­‰é«˜çº§ç”¨æ³•ï¼Œå¸®åŠ©å¼€å‘è€…é«˜æ•ˆç®¡ç†å‰ç«¯çŠ¶æ€ã€‚
top_img: /img/Pinia.png
cover: /img/Pinia.png
comments: true
toc: true
toc_number: true
toc_style_simple: false
copyright: true
copyright_author: yuxiaoling
copyright_info: ç‰ˆæƒæ‰€æœ‰ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚
mathjax: false
katex: false
aplayer: false
highlight_shrink: false
aside: true
abcjs: false
noticeOutdate: false
---

# å‰ç«¯PiniaçŠ¶æ€ç®¡ç†å®è·µ

## ä¸€ã€å¼•è¨€
åœ¨å‰ç«¯å¼€å‘çš„ä¸–ç•Œé‡Œï¼Œéšç€é¡¹ç›®è§„æ¨¡çš„ä¸æ–­æ‰©å¤§å’ŒåŠŸèƒ½çš„æ—¥ç›Šå¤æ‚ï¼ŒçŠ¶æ€ç®¡ç†æˆä¸ºäº†ä¸€ä¸ªè‡³å…³é‡è¦çš„é—®é¢˜ğŸ˜µã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œåœ¨ä¸€ä¸ªå¤§å‹çš„ç®¡ç†å¹³å°ä¸­ï¼Œæœ‰å¤šä¸ªç»„ä»¶éœ€è¦å…±äº«å’Œç®¡ç†ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ã€ä¸ªäººä¿¡æ¯ç­‰æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„çŠ¶æ€ç®¡ç†æ–¹æ¡ˆï¼Œé‚£ä¹ˆä»£ç å°†ä¼šå˜å¾—æ··ä¹±ä¸å ªï¼Œç»´æŠ¤èµ·æ¥ä¹Ÿä¼šå¼‚å¸¸å›°éš¾ğŸ˜«ã€‚

Pinia ä½œä¸ºä¸€ä¸ªè½»é‡çº§çš„çŠ¶æ€ç®¡ç†åº“ï¼Œå°±åƒæ˜¯ä¸€ä½è´´å¿ƒçš„ç®¡å®¶ğŸ§‘â€ç®¡å®¶ï¼Œä¸º Vue åº”ç”¨æä¾›äº†ä¸€ç§ç®€å•ã€é«˜æ•ˆçš„çŠ¶æ€ç®¡ç†è§£å†³æ–¹æ¡ˆã€‚å®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ç»„ç»‡å’Œç®¡ç†åº”ç”¨çš„çŠ¶æ€ï¼Œè®©ä»£ç æ›´åŠ æ¸…æ™°ã€å¯ç»´æŠ¤å’Œæ˜“äºæ‰©å±•ğŸ‘ã€‚æœ¬æ–‡å°†ç»“åˆç®¡ç†å¹³å°é¡¹ç›®ï¼Œä»¥ä¿å§†çº§çš„æ•™ç¨‹è¯¦ç»†ä»‹ç» Pinia åœ¨å‰ç«¯çŠ¶æ€ç®¡ç†ä¸­çš„å®è·µåº”ç”¨ï¼Œå³ä½¿æ˜¯æ–°æ‰‹å°ç™½ä¹Ÿèƒ½è½»æ¾ç†è§£å“¦ğŸ˜ã€‚

## äºŒã€å‰ç½®çŸ¥è¯†å‡†å¤‡
### 2.1 Vue åŸºç¡€
åœ¨å­¦ä¹  Pinia ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ Vue æœ‰ä¸€å®šçš„äº†è§£ã€‚Vue æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼ JavaScript æ¡†æ¶ï¼Œå®ƒé‡‡ç”¨äº†ç»„ä»¶åŒ–çš„å¼€å‘æ€æƒ³ï¼Œè®©æˆ‘ä»¬å¯ä»¥å°†é¡µé¢æ‹†åˆ†æˆå¤šä¸ªå°çš„ã€å¯å¤ç”¨çš„ç»„ä»¶ã€‚å¦‚æœä½ è¿˜ä¸ç†Ÿæ‚‰ Vueï¼Œå»ºè®®å…ˆå­¦ä¹ ä¸€ä¸‹ Vue çš„åŸºç¡€çŸ¥è¯†ï¼ŒåŒ…æ‹¬ç»„ä»¶ã€æŒ‡ä»¤ã€å“åº”å¼åŸç†ç­‰ã€‚

### 2.2 JavaScript åŸºç¡€
Pinia æ˜¯åŸºäº JavaScript å¼€å‘çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æŒæ¡ä¸€äº›åŸºæœ¬çš„ JavaScript çŸ¥è¯†ï¼Œå¦‚å˜é‡ã€å‡½æ•°ã€å¯¹è±¡ã€æ•°ç»„ã€Promise ç­‰ã€‚è¿™äº›çŸ¥è¯†å°†å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ç†è§£ Pinia çš„å·¥ä½œåŸç†å’Œä½¿ç”¨æ–¹æ³•ã€‚

## ä¸‰ã€Pinia ç®€ä»‹
### 3.1 ä»€ä¹ˆæ˜¯ Pinia
Pinia æ˜¯ä¸€ä¸ªåŸºäº Vue 3 çš„çŠ¶æ€ç®¡ç†åº“ï¼Œå®ƒæ˜¯ Vuex çš„ç»§ä»»è€…ï¼Œä¸“ä¸º Vue 3 è®¾è®¡ï¼Œä½†ä¹Ÿæ”¯æŒ Vue 2ã€‚Pinia çš„è®¾è®¡ç†å¿µæ˜¯ç®€å•ã€ç›´è§‚å’Œçµæ´»ï¼Œå®ƒé‡‡ç”¨äº†ç»„åˆå¼ API çš„é£æ ¼ï¼Œä½¿å¾—çŠ¶æ€ç®¡ç†æ›´åŠ ç¬¦åˆç°ä»£ Vue å¼€å‘çš„æ–¹å¼ğŸ¤©ã€‚

### 3.2 Pinia çš„ç‰¹ç‚¹
- **ç®€å•æ˜“ç”¨**ï¼šPinia çš„ API è®¾è®¡ç®€æ´æ˜äº†ï¼Œæ˜“äºä¸Šæ‰‹ã€‚å®ƒæ²¡æœ‰å¤æ‚çš„æ¦‚å¿µå’Œè¯­æ³•ï¼Œåªéœ€è¦å®šä¹‰ä¸€ä¸ª storeï¼Œå°±å¯ä»¥è½»æ¾ç®¡ç†çŠ¶æ€å•¦ğŸ˜ƒã€‚
- **ç±»å‹å®‰å…¨**ï¼šPinia æ”¯æŒ TypeScriptï¼Œèƒ½å¤Ÿåœ¨ç¼–è¯‘æ—¶æä¾›ç±»å‹æ£€æŸ¥ï¼Œå‡å°‘è¿è¡Œæ—¶é”™è¯¯ã€‚è¿™å°±å¥½æ¯”ç»™ä»£ç åŠ ä¸Šäº†ä¸€å±‚å®‰å…¨é˜²æŠ¤ç½‘ğŸ›¡ï¸ï¼Œè®©æˆ‘ä»¬çš„å¼€å‘æ›´åŠ æ”¾å¿ƒã€‚
- **æ¨¡å—åŒ–**ï¼šPinia å…è®¸å°†çŠ¶æ€åˆ†å‰²æˆå¤šä¸ª storeï¼Œæ¯ä¸ª store å¯ä»¥ç‹¬ç«‹ç®¡ç†è‡ªå·±çš„çŠ¶æ€å’Œé€»è¾‘ï¼Œä½¿å¾—ä»£ç æ›´åŠ æ¨¡å—åŒ–å’Œå¯ç»´æŠ¤ã€‚å°±åƒæŠŠä¸€ä¸ªå¤§é¡¹ç›®æ‹†åˆ†æˆå¤šä¸ªå°æ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—éƒ½æœ‰è‡ªå·±çš„èŒè´£ï¼Œåˆ†å·¥æ˜ç¡®ğŸ‘ã€‚
- **æ’ä»¶æ”¯æŒ**ï¼šPinia æä¾›äº†æ’ä»¶æœºåˆ¶ï¼Œå¯ä»¥æ–¹ä¾¿åœ°æ‰©å±•å…¶åŠŸèƒ½ï¼Œå¦‚æŒä¹…åŒ–å­˜å‚¨ã€æ—¥å¿—è®°å½•ç­‰ã€‚è¿™å°±åƒæ˜¯ç»™ Pinia è£…ä¸Šäº†å„ç§â€œæ’ä»¶ç¿…è†€â€ï¼Œè®©å®ƒå¯ä»¥æ ¹æ®æˆ‘ä»¬çš„éœ€æ±‚è‡ªç”±é£ç¿”ğŸš€ã€‚

## å››ã€åœ¨ç®¡ç†å¹³å°ä¸­å¼•å…¥ Pinia
### 4.1 åˆ›å»º Vue é¡¹ç›®
é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª Vue é¡¹ç›®ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰å®‰è£… Vue CLIï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…ï¼š
```bash
npm install -g @vue/cli
```
å®‰è£…å®Œæˆåï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ–°çš„ Vue é¡¹ç›®ï¼š
```bash
vue create my-pinia-project
cd my-pinia-project
```
### 4.2 å®‰è£… Pinia
åœ¨é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ npm æˆ– yarn æ¥å®‰è£… Piniaã€‚æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š
```bash
npm install pinia
```
æˆ–è€…
```bash
yarn add pinia
```
### 4.3 åˆå§‹åŒ– Pinia
åœ¨é¡¹ç›®çš„å…¥å£æ–‡ä»¶ `src/main.js`ï¼ˆå¦‚æœæ˜¯ Vue 3 + TypeScript é¡¹ç›®åˆ™æ˜¯ `src/main.ts`ï¼‰ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åˆå§‹åŒ– Pinia å¹¶å°†å…¶å®‰è£…åˆ° Vue åº”ç”¨ä¸­ã€‚ä»¥ä¸‹æ˜¯å…·ä½“çš„ä»£ç ç¤ºä¾‹ï¼š
```javascript
// src/main.js
import { createApp } from 'vue';
import { createPinia } from 'pinia';
import App from './App.vue';

// åˆ›å»º Pinia å®ä¾‹
const pinia = createPinia();

// åˆ›å»º Vue åº”ç”¨å®ä¾‹
const app = createApp(App);

// å°† Pinia å®‰è£…åˆ° Vue åº”ç”¨ä¸­
app.use(pinia);

// æŒ‚è½½åº”ç”¨
app.mount('#app');
```
åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¯¼å…¥äº† `createPinia` å‡½æ•°ï¼Œç„¶ååˆ›å»ºäº†ä¸€ä¸ª Pinia å®ä¾‹ `pinia`ã€‚æ¥ç€ï¼Œæˆ‘ä»¬ä½¿ç”¨ `createApp` å‡½æ•°åˆ›å»ºäº†ä¸€ä¸ª Vue åº”ç”¨å®ä¾‹ `app`ï¼Œå¹¶ä½¿ç”¨ `app.use(pinia)` å°† Pinia å®‰è£…åˆ°åº”ç”¨ä¸­ã€‚æœ€åï¼Œæˆ‘ä»¬å°†åº”ç”¨æŒ‚è½½åˆ° `#app` å…ƒç´ ä¸Šã€‚

## äº”ã€åˆ›å»ºç¬¬ä¸€ä¸ª Pinia Store
### 5.1 ä»€ä¹ˆæ˜¯ Store
åœ¨ Pinia ä¸­ï¼ŒStore æ˜¯ä¸€ä¸ªåŒ…å«çŠ¶æ€ã€åŠ¨ä½œå’Œè®¡ç®—å±æ€§çš„å¯¹è±¡ï¼Œå®ƒç”¨äºç®¡ç†åº”ç”¨çš„çŠ¶æ€ã€‚å¯ä»¥æŠŠ Store æƒ³è±¡æˆä¸€ä¸ªæ•°æ®ä»“åº“ï¼Œé‡Œé¢å­˜æ”¾ç€æˆ‘ä»¬åº”ç”¨ä¸­éœ€è¦å…±äº«å’Œç®¡ç†çš„æ•°æ®ã€‚

### 5.2 åˆ›å»ºç”¨æˆ· Store
æˆ‘ä»¬ä»¥ç®¡ç†å¹³å°ä¸­çš„ç”¨æˆ·ä¿¡æ¯ç®¡ç†ä¸ºä¾‹ï¼Œåˆ›å»ºä¸€ä¸ªç”¨æˆ· Storeã€‚åœ¨ `src/store` ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª `user.js` æ–‡ä»¶ï¼ˆå¦‚æœæ˜¯ TypeScript é¡¹ç›®åˆ™æ˜¯ `user.ts`ï¼‰ï¼Œå¹¶ç¼–å†™ä»¥ä¸‹ä»£ç ï¼š
```javascript
// src/store/user.js
import { defineStore } from 'pinia';

// å®šä¹‰ç”¨æˆ· Store
export const useUserStore = defineStore('user', {
  // çŠ¶æ€
  state: () => ({
    username: '',
    role: '',
    token: localStorage.getItem('token') || '',
  }),
  // åŠ¨ä½œ
  actions: {
    setToken(token) {
      this.token = token;
      localStorage.setItem('token', token);
    },
    clearToken() {
      this.token = '';
      localStorage.removeItem('token');
    },
    async fetchUserInfo() {
      if (!this.token) return;
      // æ¨¡æ‹Ÿè·å–ç”¨æˆ·ä¿¡æ¯çš„æ¥å£è°ƒç”¨
      const res = await new Promise((resolve) => {
        setTimeout(() => {
          resolve({
            data: {
              status: 'success',
              data: {
                username: 'John Doe',
                role: 'admin',
              },
            },
          });
        }, 1000);
      });
      if (res.data.status === 'success') {
        this.username = res.data.data.username;
        this.role = res.data.data.role;
      }
    },
    clearUserInfo() {
      this.username = '';
      this.role = '';
    },
  },
});
```
#### 5.2.1 çŠ¶æ€ï¼ˆstateï¼‰
`state` æ˜¯ Store çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œå®ƒå®šä¹‰äº† Store çš„åˆå§‹çŠ¶æ€ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸‰ä¸ªçŠ¶æ€ï¼š`username`ã€`role` å’Œ `token`ã€‚`token` ä»æœ¬åœ°å­˜å‚¨ä¸­è·å–ï¼Œå¦‚æœæœ¬åœ°å­˜å‚¨ä¸­æ²¡æœ‰ï¼Œåˆ™åˆå§‹åŒ–ä¸ºç©ºå­—ç¬¦ä¸²ã€‚çŠ¶æ€å°±åƒæ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œç”¨æ¥å­˜æ”¾æˆ‘ä»¬çš„æ•°æ®ğŸã€‚

#### 5.2.2 åŠ¨ä½œï¼ˆactionsï¼‰
`actions` æ˜¯ç”¨äºä¿®æ”¹çŠ¶æ€çš„å‡½æ•°ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†å››ä¸ªåŠ¨ä½œï¼š
- `setToken`ï¼šç”¨äºè®¾ç½® token å¹¶å°†å…¶ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ä¸­ã€‚è¿™å°±åƒæ˜¯ç»™æˆ‘ä»¬çš„ç”¨æˆ·é¢å‘äº†ä¸€ä¸ªâ€œé€šè¡Œè¯â€ğŸ“„ï¼Œæ–¹ä¾¿åç»­çš„æ“ä½œã€‚
- `clearToken`ï¼šç”¨äºæ¸…é™¤ token å¹¶ä»æœ¬åœ°å­˜å‚¨ä¸­ç§»é™¤ã€‚å°±åƒæŠŠâ€œé€šè¡Œè¯â€æ”¶å›æ¥ä¸€æ ·ï¼Œç¡®ä¿ç”¨æˆ·çš„å®‰å…¨ğŸ”’ã€‚
- `fetchUserInfo`ï¼šç”¨äºå¼‚æ­¥è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶æ›´æ–° `username` å’Œ `role` çŠ¶æ€ã€‚è¿™å°±åƒæ˜¯ä»æœåŠ¡å™¨ä¸Šâ€œæ‹‰å–â€ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ğŸ“‹ã€‚
- `clearUserInfo`ï¼šç”¨äºæ¸…é™¤ç”¨æˆ·ä¿¡æ¯ã€‚å°±åƒæŠŠç”¨æˆ·çš„ä¿¡æ¯â€œæ¸…ç©ºâ€ä¸€æ ·ï¼Œæ¢å¤åˆ°åˆå§‹çŠ¶æ€ğŸ§¹ã€‚

## å…­ã€åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ Pinia Store
### 6.1 åœ¨ç™»å½•ç»„ä»¶ä¸­ä½¿ç”¨
åœ¨ç™»å½•ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `useUserStore` å‡½æ•°æ¥è·å–ç”¨æˆ· Store çš„å®ä¾‹ï¼Œå¹¶ä½¿ç”¨å…¶ä¸­çš„çŠ¶æ€å’ŒåŠ¨ä½œã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç™»å½•ç»„ä»¶ç¤ºä¾‹ï¼š
```vue
<template>
  <div>
    <input v-model="username" placeholder="ç”¨æˆ·åæˆ–æ‰‹æœºå·" />
    <input v-model="password" type="password" placeholder="å¯†ç " />
    <button @click="login">ç™»å½•</button>
  </div>
</template>

<script setup>
import { ref } from 'vue';
import { useUserStore } from '../store/user';
import { login } from '../api/user'; // å‡è®¾è¿™æ˜¯ä¸€ä¸ªç™»å½•æ¥å£

const userStore = useUserStore();
const username = ref('');
const password = ref('');

const login = async () => {
  const res = await login({ username: username.value, password: password.value });
  if (res.data.status === 'success') {
    userStore.setToken(res.data.token);
    // ç™»å½•æˆåŠŸåè·³è½¬åˆ°ä¸»é¡µ
    window.location.href = '/';
  }
};
</script>
```
åœ¨è¿™ä¸ªç™»å½•ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¯¼å…¥äº† `useUserStore` å‡½æ•°å’Œ `login` æ¥å£ï¼Œç„¶ååˆ›å»ºäº† `userStore` å®ä¾‹å’Œä¸¤ä¸ªå“åº”å¼å˜é‡ `username` å’Œ `password`ã€‚å½“ç”¨æˆ·ç‚¹å‡»ç™»å½•æŒ‰é’®æ—¶ï¼Œè°ƒç”¨ `login` å‡½æ•°è¿›è¡Œç™»å½•éªŒè¯ï¼Œå¦‚æœç™»å½•æˆåŠŸï¼Œè°ƒç”¨ `userStore.setToken` æ–¹æ³•è®¾ç½® tokenï¼Œå¹¶è·³è½¬åˆ°ä¸»é¡µğŸ‰ã€‚

### 6.2 åœ¨éœ€è¦è·å–ç”¨æˆ·ä¿¡æ¯çš„ç»„ä»¶ä¸­ä½¿ç”¨
åœ¨éœ€è¦è·å–ç”¨æˆ·ä¿¡æ¯çš„ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨ `fetchUserInfo` åŠ¨ä½œæ¥æ›´æ–°ç”¨æˆ·ä¿¡æ¯ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç»„ä»¶ç¤ºä¾‹ï¼š
```vue
<template>
  <div>
    <p>ç”¨æˆ·å: {{ userStore.username }}</p>
    <p>è§’è‰²: {{ userStore.role }}</p>
  </div>
</template>

<script setup>
import { useUserStore } from '../store/user';

const userStore = useUserStore();
userStore.fetchUserInfo();
</script>
```
åœ¨è¿™ä¸ªç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯¼å…¥äº† `useUserStore` å‡½æ•°å¹¶åˆ›å»ºäº† `userStore` å®ä¾‹ï¼Œç„¶åè°ƒç”¨ `fetchUserInfo` æ–¹æ³•è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶åœ¨æ¨¡æ¿ä¸­æ˜¾ç¤ºå‡ºæ¥ğŸ˜ã€‚

## ä¸ƒã€Pinia çš„é«˜çº§ç”¨æ³•
### 7.1 è®¡ç®—å±æ€§ï¼ˆgettersï¼‰
Pinia æ”¯æŒè®¡ç®—å±æ€§ï¼Œç”¨äºä»çŠ¶æ€ä¸­æ´¾ç”Ÿæ•°æ®ã€‚è®¡ç®—å±æ€§å°±åƒæ˜¯ä¸€ä¸ªâ€œåŠ å·¥å‚â€ï¼Œå¯ä»¥æ ¹æ®ç°æœ‰çš„çŠ¶æ€æ•°æ®ç”Ÿæˆæ–°çš„æ•°æ®ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç”¨æˆ· Store ä¸­å®šä¹‰ä¸€ä¸ªè®¡ç®—å±æ€§æ¥åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•ï¼š
```javascript
// src/store/user.js
import { defineStore } from 'pinia';

export const useUserStore = defineStore('user', {
  state: () => ({
    username: '',
    role: '',
    token: localStorage.getItem('token') || '',
  }),
  getters: {
    isLoggedIn: (state) => !!state.token,
  },
  actions: {
    setToken(token) {
      this.token = token;
      localStorage.setItem('token', token);
    },
    clearToken() {
      this.token = '';
      localStorage.removeItem('token');
    },
    async fetchUserInfo() {
      if (!this.token) return;
      const res = await new Promise((resolve) => {
        setTimeout(() => {
          resolve({
            data: {
              status: 'success',
              data: {
                username: 'John Doe',
                role: 'admin',
              },
            },
          });
        }, 1000);
      });
      if (res.data.status === 'success') {
        this.username = res.data.data.username;
        this.role = res.data.data.role;
      }
    },
    clearUserInfo() {
      this.username = '';
      this.role = '';
    },
  },
});
```
åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªè®¡ç®—å±æ€§ `isLoggedIn`ï¼Œå®ƒè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºç”¨æˆ·æ˜¯å¦ç™»å½•ã€‚åœ¨ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªè®¡ç®—å±æ€§ï¼š
```vue
<template>
  <div>
    <p v-if="userStore.isLoggedIn">å·²ç™»å½•</p>
    <p v-else>æœªç™»å½•</p>
  </div>
</template>

<script setup>
import { useUserStore } from '../store/user';

const userStore = useUserStore();
</script>
```
### 7.2 æ’ä»¶çš„ä½¿ç”¨
Pinia æä¾›äº†æ’ä»¶æœºåˆ¶ï¼Œå¯ä»¥æ–¹ä¾¿åœ°æ‰©å±•å…¶åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `pinia-plugin-persistedstate` æ’ä»¶æ¥å®ç°çŠ¶æ€çš„æŒä¹…åŒ–å­˜å‚¨ï¼Œè¿™æ ·å³ä½¿ç”¨æˆ·åˆ·æ–°é¡µé¢ï¼ŒçŠ¶æ€æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ğŸ§ã€‚

#### 7.2.1 å®‰è£…æ’ä»¶
é¦–å…ˆï¼Œä½¿ç”¨ npm æˆ– yarn å®‰è£… `pinia-plugin-persistedstate` æ’ä»¶ï¼š
```bash
npm install pinia-plugin-persistedstate
```
æˆ–è€…
```bash
yarn add pinia-plugin-persistedstate
```
#### 7.2.2 ä½¿ç”¨æ’ä»¶
åœ¨ `src/main.js` ä¸­ä½¿ç”¨æ’ä»¶ï¼š
```javascript
// src/main.js
import { createApp } from 'vue';
import { createPinia } from 'pinia';
import piniaPluginPersistedstate from 'pinia-plugin-persistedstate';
import App from './App.vue';

const pinia = createPinia();
pinia.use(piniaPluginPersistedstate);

const app = createApp(App);
app.use(pinia);
app.mount('#app');
```
#### 7.2.3 é…ç½®æ’ä»¶
åœ¨ Store ä¸­é…ç½®æ’ä»¶ï¼Œè®©ç”¨æˆ· Store çš„çŠ¶æ€æ•°æ®æŒä¹…åŒ–ï¼š
```javascript
// src/store/user.js
import { defineStore } from 'pinia';

export const useUserStore = defineStore('user', {
  state: () => ({
    username: '',
    role: '',
    token: localStorage.getItem('token') || '',
  }),
  actions: {
    setToken(token) {
      this.token = token;
      localStorage.setItem('token', token);
    },
    clearToken() {
      this.token = '';
      localStorage.removeItem('token');
    },
    async fetchUserInfo() {
      if (!this.token) return;
      const res = await new Promise((resolve) => {
        setTimeout(() => {
          resolve({
            data: {
              status: 'success',
              data: {
                username: 'John Doe',
                role: 'admin',
              },
            },
          });
        }, 1000);
      });
      if (res.data.status === 'success') {
        this.username = res.data.data.username;
        this.role = res.data.data.role;
      }
    },
    clearUserInfo() {
      this.username = '';
      this.role = '';
    },
  },
  // å¼€å¯æŒä¹…åŒ–å­˜å‚¨
  persist: true,
});
```
é€šè¿‡ä»¥ä¸Šé…ç½®ï¼Œç”¨æˆ· Store çš„çŠ¶æ€æ•°æ®å°†ä¼šè‡ªåŠ¨æŒä¹…åŒ–å­˜å‚¨åˆ°æœ¬åœ°å­˜å‚¨ä¸­ï¼Œå®ç°äº†æ•°æ®çš„æŒä¹…åŒ–ğŸ‰ã€‚

## å…«ã€æ€»ç»“
é€šè¿‡åœ¨ç®¡ç†å¹³å°é¡¹ç›®ä¸­ä½¿ç”¨ Pinia è¿›è¡ŒçŠ¶æ€ç®¡ç†ï¼Œæˆ‘ä»¬å¯ä»¥æ›´åŠ æ–¹ä¾¿åœ°ç®¡ç†ç”¨æˆ·ä¿¡æ¯å’Œç™»å½•çŠ¶æ€ã€‚Pinia çš„ç®€å•æ˜“ç”¨ã€ç±»å‹å®‰å…¨å’Œæ¨¡å—åŒ–ç­‰ç‰¹ç‚¹ï¼Œä½¿å¾—æˆ‘ä»¬çš„ä»£ç æ›´åŠ æ¸…æ™°ã€å¯ç»´æŠ¤å’Œæ˜“äºæ‰©å±•ğŸ‘ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®é¡¹ç›®çš„éœ€æ±‚ï¼Œçµæ´»è¿ç”¨ Pinia çš„å„ç§åŠŸèƒ½ï¼Œå¦‚è®¡ç®—å±æ€§ã€æ’ä»¶ç­‰ï¼Œæé«˜å¼€å‘æ•ˆç‡å’Œä»£ç è´¨é‡ğŸ’¯ã€‚å¸Œæœ›æœ¬æ–‡èƒ½å¤Ÿå¸®åŠ©æ–°æ‰‹å°ç™½æ›´å¥½åœ°ç†è§£å’ŒæŒæ¡ Pinia çŠ¶æ€ç®¡ç†ï¼Œè®©æˆ‘ä»¬åœ¨å‰ç«¯å¼€å‘çš„é“è·¯ä¸Šè¶Šèµ°è¶Šè¿œğŸš€ï¼