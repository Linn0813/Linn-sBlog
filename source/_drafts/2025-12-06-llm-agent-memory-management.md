---
title: ğŸ§  7/15ï½œAgent è®°å¿†ç®¡ç†ï¼šæ‰“é€ é•¿æœŸä¸”å¥å¿˜çš„æ™ºèƒ½ä½“
date: 2025-12-06 18:00:00
series: ğŸ§  LLM/Agent ä»å…¥é—¨åˆ°ç²¾é€šï¼šå‘Šåˆ«æµ…å°è¾„æ­¢
categories:
  - æŠ€æœ¯å­¦ä¹ ä¸è¡Œä¸šè¶‹åŠ¿
  - AIä¸ç ”ç©¶
tags:
  - LLM
  - Agent
  - Memory
  - Context Window
  - è®°å¿†ç®¡ç†
  - å‘é‡æ•°æ®åº“
keywords: LLM, Agent, Memory, Context Window, è®°å¿†ç®¡ç†, STM, LTM, çŸ­æœŸè®°å¿†, é•¿æœŸè®°å¿†, å‘é‡æ•°æ®åº“, çŸ¥è¯†å›¾è°±
description: 'æ·±å…¥è§£æ Agent çš„è®°å¿†ç®¡ç†ï¼šä»åˆ†å±‚è®°å¿†æ¶æ„ã€çŸ­æœŸè®°å¿†ç®¡ç†ç­–ç•¥åˆ°é•¿æœŸè®°å¿†å­˜å‚¨æ£€ç´¢ï¼Œæ‰“é€ é•¿æœŸä¸”å¥å¿˜çš„æ™ºèƒ½ä½“ç³»ç»Ÿ'
top_img: /img/llm-agent-memory-management.png
cover: /img/llm-agent-memory-management.png
comments: true
toc: true
toc_number: true
toc_style_simple: false
copyright: true
copyright_author: yuxiaoling
copyright_info: ç‰ˆæƒæ‰€æœ‰ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚
mathjax: true
katex: false
aplayer: false
highlight_shrink: false
aside: true
noticeOutdate: false
---

> **è¿™æ˜¯ã€ŠLLM/Agent æ ¸å¿ƒçŸ¥è¯†ä½“ç³»ã€‹ç³»åˆ—ç¬¬ 7 ç¯‡**

> ä¸Šä¸€ç¯‡æˆ‘ä»¬æ·±å…¥è§£æäº† Agent çš„å†³ç­–å¼•æ“ï¼ŒæŒæ¡äº† ReActã€Self-Ask å’Œ Tree of Thoughts ç­‰é«˜çº§ç­–ç•¥ã€‚

> æœ¬ç¯‡ï¼Œæˆ‘ä»¬å°†èšç„¦ Agent çš„è®°å¿†ç®¡ç†ï¼Œæ¢è®¨å¦‚ä½•çªç ´ Context Window é™åˆ¶ï¼Œå®ç°é•¿æœŸä¸”è¿è´¯çš„è®°å¿†ç³»ç»Ÿã€‚

---

## ğŸš€ å¯¼è¨€ â€” çªç ´ Context Window çš„ç“¶é¢ˆ

LLM çš„ **Context Windowï¼ˆä¸Šä¸‹æ–‡çª—å£ï¼‰**æ˜¯å…¶çŸ­æœŸè®°å¿†çš„"å®¹å™¨"ï¼Œä½†å®¹é‡æœ‰é™ä¸”æˆæœ¬é«˜ã€‚åœ¨å¤šè½®å¯¹è¯æˆ–å¤æ‚é¡¹ç›®ç®¡ç†ä¸­ï¼ŒAgent å¾ˆå¿«ä¼šå¿˜è®°æ—©æœŸå…³é”®ä¿¡æ¯ï¼Œç”šè‡³å›  Context Window æº¢å‡ºè€Œå´©æºƒã€‚

**Agent çš„è®°å¿†ç®¡ç†**ä¸ä»…ä»…æ˜¯ç®€å• RAG çš„åº”ç”¨ï¼Œè€Œæ˜¯ä¸€å¥—å®Œæ•´çš„ **å­˜å‚¨ â†’ æ£€ç´¢ â†’ å‹ç¼© â†’ æ›´æ–°** ç³»ç»Ÿã€‚æœ¬ç¯‡å°†æ·±å…¥è§£æ **åˆ†å±‚è®°å¿†æ¶æ„**ï¼Œå±•ç¤ºå¦‚ä½•é€šè¿‡å·¥ç¨‹åŒ–æ‰‹æ®µè®© Agent **æ—¢èƒ½è®°ä½å…³é”®ä¿¡æ¯ï¼Œåˆèƒ½æ™ºèƒ½é—å¿˜ä¸é‡è¦çš„ç»†èŠ‚**ã€‚

---

## ä¸€ã€Agent çš„åˆ†å±‚è®°å¿†æ¶æ„

Agent çš„è®°å¿†è®¾è®¡æ¨¡ä»¿äººç±»å¤§è„‘çš„ **åˆ†å±‚ç»“æ„**ï¼š

| å±‚æ¬¡             | æ¦‚å¿µæ¯”å–»              | å­˜å‚¨ä»‹è´¨                    | å†…å®¹ä¸åŠŸèƒ½                                           | æ ¸å¿ƒæŒ‘æˆ˜                |
| :------------- | :---------------- | :---------------------- | :---------------------------------------------- | :------------------ |
| **çŸ­æœŸè®°å¿† (STM)** | **å¤§è„‘ RAM**        | Context Window (Prompt) | å½“å‰ä¼šè¯çš„ Thought / Action / Observation åºåˆ—ï¼Œç¡®ä¿ä»»åŠ¡è¿è´¯æ€§ | **Token é•¿åº¦é™åˆ¶**ï¼šå®¹æ˜“æº¢å‡º |
| **é•¿æœŸè®°å¿† (LTM)** | **ç¡¬ç›˜ Hard Drive** | å‘é‡æ•°æ®åº“ / çŸ¥è¯†å›¾è°±            | å†å²ç»éªŒã€ç”¨æˆ·åå¥½ã€é¡¹ç›®è¿›åº¦æ‘˜è¦                                | **é«˜æ•ˆæ£€ç´¢**ï¼šå¦‚ä½•å¬å›ç›¸å…³ä¿¡æ¯   |
| **å¤–éƒ¨çŸ¥è¯† (ExM)** | **ç™¾ç§‘å…¨ä¹¦**          | RAG çŸ¥è¯†åº“ / API æ•°æ®        | äº‹å®æ€§ã€ä¸“ä¸šæ€§ã€éä¸ªäººåŒ–ä¿¡æ¯                                  | **çŸ¥è¯†æ—¶æ•ˆæ€§**ï¼šéœ€è¦å®šæœŸæ›´æ–°    |

> **ğŸ’¡ å·¥ç¨‹æç¤ºï¼š** STM ä¿è¯å½“å‰ä»»åŠ¡è¿è´¯ï¼ŒLTM ä¿å­˜ç»éªŒä¸ä¸Šä¸‹æ–‡ï¼ŒExM æä¾›äº‹å®æ€§æ”¯æŒï¼Œä¸‰è€…ç»“åˆç¡®ä¿ Agent çš„é•¿æœŸè‡ªä¸»æ€§ã€‚

---

## äºŒã€çŸ­æœŸè®°å¿† (STM) çš„ç®¡ç†ç­–ç•¥

çŸ­æœŸè®°å¿†ç¡®ä¿ **Agentic Loop** çš„è¿è´¯æ€§ï¼Œä½†å—é™äº Context Windowï¼Œéœ€è¦é«˜æ•ˆå‹ç¼©å’ŒåŠ¨æ€é—å¿˜ã€‚

### 2.1 Sliding Windowï¼ˆæ»‘åŠ¨çª—å£ï¼‰

* **æœºåˆ¶ï¼š** ä¿ç•™æœ€è¿‘ N è½® Thought / Action / Observationï¼Œæ—§ä¿¡æ¯è¢«ä¸¢å¼ƒæˆ–è¿ç§»åˆ° LTM

* **é€‚ç”¨åœºæ™¯ï¼š** å¯¹è¯è½®æ¬¡æœ‰é™æˆ–ä»»åŠ¡æ­¥éª¤æ˜ç¡®

### 2.2 Conversational Summarizationï¼ˆå¯¹è¯æ‘˜è¦ï¼‰

* **æœºåˆ¶ï¼š** LLM å®šæœŸå¯¹æœ€æ—§å†…å®¹è¿›è¡Œæ‘˜è¦

* **ä»·å€¼ï¼š** èŠ‚çœ Token ç©ºé—´ï¼ŒåŒæ—¶ä¿ç•™å…³é”®ä¸»é¢˜å’Œç»“è®º

* **å·¥ç¨‹å®ç°ï¼š** æ¯ K è½®å¾ªç¯è°ƒç”¨ **Summarizer LLM**ï¼Œç”Ÿæˆæ›´æ–°åçš„è®°å¿†ç‰‡æ®µ

### 2.3 Importance-Based Pruningï¼ˆåŸºäºé‡è¦æ€§çš„å‰ªæï¼‰

* **æœºåˆ¶ï¼š** ä¸ºæ¯æ®µè®°å¿†åˆ†é… **é‡è¦æ€§å¾—åˆ†**

* **è¯„åˆ†æ–¹å¼ï¼š** é€šè¿‡å°å‹åˆ†ç±»æ¨¡å‹æˆ– LLM Promptï¼Œæ ¹æ®ä¸æ ¸å¿ƒä»»åŠ¡ç›®æ ‡çš„å…³è”æ€§è¯„åˆ†

* **ç»“æœï¼š** å½“ Context Window æ»¡è½½æ—¶ï¼Œä¼˜å…ˆç§»é™¤ä½åˆ†è®°å¿†ï¼Œå®ç°"æœ‰é€‰æ‹©çš„é—å¿˜"

> **ç¤ºä¾‹ä¼ªä»£ç ï¼š**

```python

def prune_stm(memory_list, max_tokens):

    memory_list.sort(key=lambda x: x.importance, reverse=True)

    while memory_token_count(memory_list) > max_tokens:

        memory_list.pop()  # ç§»é™¤æœ€ä½é‡è¦æ€§è®°å¿†

    return memory_list

```

---

## ä¸‰ã€é•¿æœŸè®°å¿† (LTM) çš„å­˜å‚¨ä¸æ£€ç´¢

é•¿æœŸè®°å¿†è´Ÿè´£ **æŒä¹…åŒ–ç»éªŒä¸ç”¨æˆ·ç”»åƒ**ï¼Œæ ¸å¿ƒåœ¨äºé«˜æ•ˆæ£€ç´¢ã€‚

### 3.1 å­˜å‚¨ä»‹è´¨å¤šæ ·æ€§

1. **å‘é‡æ•°æ®åº“ (Vector Stores)**

   * å­˜å‚¨å†å²å¯¹è¯ã€Observationã€Thought

   * æ£€ç´¢ï¼šè¯­ä¹‰ç›¸ä¼¼æ€§æœç´¢ï¼ˆRAG åŸºç¡€ï¼‰

2. **çŸ¥è¯†å›¾è°± (Knowledge Graphs)**

   * å­˜å‚¨ç»“æ„åŒ–å…³ç³»ï¼ˆå¦‚ç”¨æˆ·åå¥½ä¸é¡¹ç›®å…³è”ï¼‰

   * æ£€ç´¢ï¼šå¤šè·³æ¨ç†ï¼ˆCypher / SPARQLï¼‰

3. **Key-Value / å…³ç³»å‹æ•°æ®åº“ (SQL/NoSQL)**

   * å­˜å‚¨ç”¨æˆ·é…ç½®ã€é¡¹ç›®çŠ¶æ€ã€ä»»åŠ¡æ¸…å•

   * æ£€ç´¢ï¼šFunction Calling æˆ– Text-to-SQL

### 3.2 é«˜çº§æ£€ç´¢ç­–ç•¥ï¼šContextual Memory Retrieval

ç»“åˆ **è¯­ä¹‰ç›¸ä¼¼æ€§ã€æ—¶æ•ˆæ€§ã€é‡è¦æ€§**è¿›è¡Œè®°å¿†å¬å›ï¼š

$$\text{Recall Score} = \alpha \cdot \text{Contextual Similarity} + \beta \cdot \text{Recency} + \gamma \cdot \text{Importance}$$

* **Recencyï¼ˆæ—¶æ•ˆæ€§ï¼‰**ï¼šè¿‘æœŸäº‹ä»¶æƒé‡æ›´é«˜

* **Contextual Similarityï¼ˆè¯­ä¹‰ç›¸ä¼¼åº¦ï¼‰**ï¼šç¡®ä¿ä¸å½“å‰ä»»åŠ¡ç›¸å…³

* **Importanceï¼ˆé‡è¦æ€§ï¼‰**ï¼šå…³é”®äº‹ä»¶ä¼˜å…ˆå¬å›

> **ğŸ’¡ å·¥ç¨‹å®è·µï¼š** ç»“åˆå¤šç­–ç•¥æ’åºï¼Œæé«˜é•¿æœŸä»»åŠ¡çš„è®°å¿†ç²¾åº¦å’Œæ•ˆç‡ã€‚

---

## å››ã€è®°å¿†ç®¡ç†æ€»çº¿ï¼šä¿¡æ¯æµè½¬æœºåˆ¶

å®Œæ•´è®°å¿†ç³»ç»Ÿéœ€è¦ä¸€ä¸ª **Memory Stream** æ¥ç®¡ç†ä¿¡æ¯æµå…¥ä¸æµå‡ºï¼š

1. **Perceiverï¼ˆæ„ŸçŸ¥å™¨ï¼‰**ï¼šé¢„å¤„ç†ç”¨æˆ·è¾“å…¥ä¸ Observationï¼Œè¿›è¡Œåˆ†å—

2. **Embedding Generator**ï¼šå°† Perceiver è¾“å‡ºè½¬æ¢ä¸ºå‘é‡ï¼Œå­˜å…¥ LTM

3. **Retrieval Module**ï¼šPlanner å¯åŠ¨å‰ï¼Œæ£€ç´¢ Top K è®°å¿†ç‰‡æ®µ

4. **Context Refinerï¼ˆä¸Šä¸‹æ–‡ç²¾ç‚¼å™¨ï¼‰**ï¼šæ•´åˆ STM æ‘˜è¦ã€LTM æ£€ç´¢ç»“æœåŠå½“å‰è¾“å…¥ï¼Œå½¢æˆé«˜æ•ˆ Prompt æ³¨å…¥ LLM Planner

   * é˜²æ­¢"ä¸Šä¸‹æ–‡æ±¡æŸ“"

   * æå‡ LLM æ¨ç†æ•ˆç‡

> **ç¤ºæ„å›¾å»ºè®®ï¼š**

```
User Input â†’ Perceiver â†’ Embedding â†’ LTM Storage

                               â†“

                      Retrieval â†’ Context Refiner â†’ LLM Planner

```

---

## ğŸ” æ€»ç»“ï¼šAgent çš„è®°å¿†æ˜¯è‡ªä¸»æ€§çš„è½½ä½“

* STMï¼šä¿è¯å½“å‰ä»»åŠ¡çš„å³æ—¶è¿è´¯

* LTMï¼šæŒä¹…åŒ–ç»éªŒï¼Œæ”¯æŒè·¨ä»»åŠ¡å­¦ä¹ 

* ExMï¼šæä¾›äº‹å®æ€§ä¸ä¸“ä¸šçŸ¥è¯†

ä¸€ä¸ªä¼˜ç§€çš„ Agent å·¥ç¨‹å¸ˆï¼Œä¸ä»…è¦è®© Agent **è®°ä½é‡è¦ä¿¡æ¯**ï¼Œæ›´è¦è®©å®ƒ **æ™ºèƒ½é—å¿˜**ï¼Œç²¾å‡†å¬å›é«˜ä»·å€¼è®°å¿†ï¼Œå®ç°é•¿æœŸè‡ªä¸»æ€§ã€‚

---

## ğŸ“š çŸ¥è¯†æ¥æºä¸è¿›é˜¶é˜…è¯»ï¼ˆå¸¦é“¾æ¥ï¼‰

| ä¸»é¢˜                   | é“¾æ¥                                                                                                                                                 |
| -------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------- |
| **åˆ†å±‚è®°å¿†**             | [Agent Memory Architecture, Layered Memory Model](https://arxiv.org/abs/2304.12213)                                                                |
| **è®°å¿†æ£€ç´¢**             | [Contextual Memory Retrieval, Recency & Importance Weighted Search (LlamaIndex)](https://gpt-index.readthedocs.io/en/latest/use_cases/memory.html) |
| **ç”Ÿæˆå¼ Agent**        | [Generative Agents: Interactive Simulacra of Human Behavior (Stanford 2023)](https://arxiv.org/abs/2304.03442)                                     |
| **çŸ¥è¯†å›¾è°±åœ¨ Agent ä¸­çš„åº”ç”¨** | [Knowledge Graph for LLM Agent Reasoning](https://neo4j.com/blog/knowledge-graphs-for-llms/)                                                       |

---

## ğŸ”” ä¸‹ä¸€ç¯‡é¢„å‘Š

è®°å¿†ã€å†³ç­–å’Œ RAG æ„æˆäº† Agent çš„å†…éƒ¨èƒ½åŠ›ï¼Œä½†ç°å®ä¸–ç•Œä¸­ï¼ŒAgent å¿…é¡»ä¸å¤–ç•Œäº¤äº’ã€‚ä¸‹ä¸€ç¯‡å°†èšç„¦ **Agent çš„å·¥å…·ç³»ç»Ÿ**ï¼Œè§£æ **Function Calling** æœºåˆ¶ä¸å·¥å…·æ ‡å‡†åŒ–è®¾è®¡ã€‚

**ç¬¬ 8 ç¯‡æ ‡é¢˜ï¼ˆæš‚å®šï¼‰ï¼š**

### ã€ŠAgent å·¥å…·ç³»ç»Ÿï¼šFunction Calling ä¸å¤–éƒ¨ä¸–ç•Œè¿æ¥ã€‹

