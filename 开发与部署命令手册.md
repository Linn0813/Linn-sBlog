# Blog 项目开发与部署命令手册

适用范围：当前 `Blog` 仓库（Hexo + Butterfly 主题 + `qa-service`）

## 1) 初始化环境

```bash
# 在项目根目录
cd /Users/yuxiaoling/Blog

# 安装博客依赖
npm install
```

如果要开发 QA 前端：

```bash
cd /Users/yuxiaoling/Blog/qa-service/frontend
npm install
```

如果要开发 QA 后端：

```bash
cd /Users/yuxiaoling/Blog/qa-service/backend
pip install -e .
```

## 2) 博客日常开发命令（Hexo）

```bash
cd /Users/yuxiaoling/Blog

# 本地预览（推荐）
npm run preview

# 等价命令
npm run server
hexo server

# 清理缓存
npm run clean
hexo clean

# 生成静态文件
npm run build
hexo generate
```

## 3) 文章写作命令

```bash
cd /Users/yuxiaoling/Blog

# 新建草稿
hexo new draft "文章标题"

# 发布草稿为正式文章
hexo publish "文章标题"

# 新建正式文章
hexo new "文章标题"
```

## 4) QA 服务开发命令

### 4.1 启动 QA 后端（FastAPI）

```bash
cd /Users/yuxiaoling/Blog/qa-service/backend
python -m app.main
```

### 4.2 启动 QA 前端（Vite）

```bash
cd /Users/yuxiaoling/Blog/qa-service/frontend
npm run dev
```

### 4.3 QA 前端生产构建

```bash
cd /Users/yuxiaoling/Blog/qa-service/frontend
npm run build
```

## 5) 把 QA 前端集成到博客

```bash
cd /Users/yuxiaoling/Blog
./integrate-qa.sh
```

如果希望集成时自动同步博客文章到向量库：

```bash
cd /Users/yuxiaoling/Blog
AUTO_SYNC_BLOG=true ./integrate-qa.sh
```

## 6) 一键部署 QA + 博客

```bash
cd /Users/yuxiaoling/Blog
./deploy-qa.sh
```

常用参数：

```bash
# 跳过前端构建
./deploy-qa.sh --skip-build

# 跳过集成
./deploy-qa.sh --skip-integrate

# 跳过博客生成
./deploy-qa.sh --skip-generate

# 跳过部署
./deploy-qa.sh --skip-deploy

# 自动同步博客文章
./deploy-qa.sh --auto-sync
```

## 7) 博客部署命令

```bash
cd /Users/yuxiaoling/Blog

# 常规部署
npm run deploy
hexo deploy

# 一键生成+部署
hexo g -d
```

网络不稳定时使用重试部署：

```bash
cd /Users/yuxiaoling/Blog
./deploy_with_retry.sh
```

## 8) 主题命令（当前仅 Butterfly）

```bash
cd /Users/yuxiaoling/Blog

# 确保主题为 butterfly
npm run theme:butterfly

# 切换并重新生成
npm run switch:butterfly
```

## 9) 同步博客文章到 QA 后端

```bash
cd /Users/yuxiaoling/Blog
npm run sync-blog
```

## 10) 常用检查命令

```bash
cd /Users/yuxiaoling/Blog

# 查看 Hexo 版本
npx hexo -v

# 查看 QA 后端健康状态（后端启动后）
curl http://localhost:8113/healthz

# 查看 Git 状态
git status
```

